import{a as J,b as G,d as K,e as Q}from"./chunk-PG437ZKC.js";import{h as V}from"./chunk-SKQRQWWF.js";import"./chunk-FAPK36KY.js";import{B as $,Ca as q,Ha as g,Ja as v,Ka as w,Ma as T,Na as I,Pa as R,Qa as F,Ra as a,Sa as o,Ta as M,Ub as A,W as y,Wa as x,Xa as _,Ya as p,a as j,b as U,da as L,ea as h,fa as C,fb as l,fc as k,gb as c,gc as D,hb as P,hc as N,ib as B,jb as z,jc as O,lb as E,ma as S,qb as m,rb as u,sb as H,ua as s,va as b}from"./chunk-XEDVPAYN.js";function ne(i,d){if(i&1){let e=x();a(0,"app-pagination",11),_("pageSelected",function(t){h(e);let r=p();return C(r.onPageNumClick(t))}),o()}if(i&2){let e=p();v("currentPage",e.currentPage)("totalPages",e.totalPages)}}function ie(i,d){if(i&1){let e=x();a(0,"button",18),_("click",function(){let t=h(e).$implicit,r=p(2).$implicit,f=p();return C(f.onEmployeeSelected(r,t))}),l(1),o()}if(i&2){let e=d.$implicit,n=p(2).$implicit;w("is-info",n.employee===e),s(),c(e)}}function ae(i,d){if(i&1&&R(0,ie,2,3,"button",17,I),i&2){let e=p(2);F(e.employeeList)}}function oe(i,d){if(i&1&&(a(0,"button",16),l(1),m(2,"translate"),o()),i&2){let e=p().$implicit;s(),P(" ",u(2,1,e.employee?e.employee:"Not assigned")," ")}}function se(i,d){if(i&1){let e=x();a(0,"tr")(1,"td",12),l(2),m(3,"date"),o(),a(4,"td",12),l(5),o(),a(6,"td",12),l(7),o(),a(8,"td",13),_("click",function(){let t=h(e).$implicit,r=p();return C(r.onTransactionClick(t))}),a(9,"div"),l(10),m(11,"transactionServicesPipe"),o()(),a(12,"td",14)(13,"div",15),g(14,ae,2,0)(15,oe,3,3,"button",16),o()()()}if(i&2){let e=d.$implicit,n=p();s(2),c(H(3,5,e.date_time,"MMM dd HH:mm")),s(3),c(e.receipt_num),s(2),c(e.money_accepted),s(3),c(u(11,8,e.services)),s(4),T(!e.readonly&&n.authService.getAccessLevel()>1?14:15)}}var Y=(()=>{class i{authService;httpService;transactionUpd=new S;pageSelected=new S;httpResponse;employeeList;screenSize=screen.width;totalPages;currentPage;transactionDetails;showDetails=!1;constructor(e,n){this.authService=e,this.httpService=n}ngOnChanges(e){e.httpResponse&&(this.totalPages=this.httpResponse?.totalPages,this.currentPage=this.httpResponse?.currentPage,this.currentPage=this.currentPage?this.currentPage+1:1)}onPageNumClick(e){this.pageSelected.emit(e)}onTransactionClick(e){this.transactionDetails=e,this.showDetails=!0}onEmployeeSelected(e,n){e.employee=n,this.transactionUpd.emit("update")}onCloseTransactionDetails(e){if(this.showDetails=!1,typeof e=="boolean")return;let n=this.httpResponse?.transactionsOnThePage.find(r=>r.receipt_num===e);n&&(n.employee="Deleting");let t=this.httpService.cancelMoneyFlow(e).pipe($(()=>{this.pageSelected.emit(this.currentPage)}));this.transactionUpd.emit(t)}static \u0275fac=function(n){return new(n||i)(b(V),b(O))};static \u0275cmp=y({type:i,selectors:[["app-transactions-table"]],inputs:{httpResponse:"httpResponse",employeeList:"employeeList"},outputs:{transactionUpd:"transactionUpd",pageSelected:"pageSelected"},standalone:!0,features:[L,E],decls:39,vars:27,consts:[[1,"container","is-max-tablet"],[1,"is-flex","is-justify-content-center"],[1,"table","is-hoverable","is-striped","is-narrow-mobile","has-text-centered","is-size-7-mobile","is-size-6","my-2","mx-0","px-0","is-fullwidth"],["colspan","5",1,"m-0","p-0"],[1,"is-flex","is-justify-content-center","mb-1"],[3,"currentPage","totalPages"],[1,"has-background-danger-95"],[1,"has-text-centered"],[1,"has-background-info-95"],[1,"has-text-centered","has-text-weight-bold"],[3,"close","active","transaction"],[3,"pageSelected","currentPage","totalPages"],[1,"has-text-centered","is-vcentered"],[1,"has-text-left",3,"click"],[1,"p-1","is-vcentered"],[1,"tags","is-centered"],[1,"tag","is-info"],[1,"tag","is-hoverable",3,"is-info"],[1,"tag","is-hoverable",3,"click"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1)(2,"table",2)(3,"thead")(4,"tr")(5,"td",3)(6,"div",4),g(7,ne,1,2,"app-pagination",5),o()()(),a(8,"tr",6)(9,"th",7),l(10),m(11,"translate"),o(),a(12,"th",7),l(13),m(14,"translate"),o(),a(15,"th",7),l(16),m(17,"translate"),o(),a(18,"th",7),l(19),m(20,"translate"),o(),a(21,"th",7),l(22),m(23,"translate"),o()()(),a(24,"tbody"),R(25,se,16,10,"tr",null,I),o(),a(27,"tfoot")(28,"tr",8),M(29,"td"),a(30,"td",9),l(31),o(),a(32,"td",9),l(33),o(),a(34,"td",9),l(35),m(36,"translate"),o(),M(37,"td"),o()()()()(),a(38,"app-transaction-details",10),_("close",function(f){return t.onCloseTransactionDetails(f)}),o()),n&2&&(s(7),T(t.currentPage&&t.totalPages?7:-1),s(3),c(u(11,15,"Time")),s(3),c(u(14,17,"Receipt")),s(3),c(u(17,19,"Paid")),s(3),c(u(20,21,"Services")),s(3),c(u(23,23,"Employee")),s(3),F(t.httpResponse==null?null:t.httpResponse.transactionsOnThePage),s(6),B("",t.httpResponse==null||t.httpResponse.transactionsOnThePage==null?null:t.httpResponse.transactionsOnThePage.length,"/",t.httpResponse==null?null:t.httpResponse.count,""),s(2),B("",t.httpResponse==null?null:t.httpResponse.pageSum,"/",t.httpResponse==null?null:t.httpResponse.sum,""),s(2),z("",u(36,25,"Page")," ",(t.httpResponse==null?null:t.httpResponse.currentPage)+1," / ",t.httpResponse==null?null:t.httpResponse.totalPages,""),s(3),v("active",t.showDetails)("transaction",t.transactionDetails))},dependencies:[J,K,G,A,D,k],styles:[".date-time[_ngcontent-%COMP%]{min-width:90px}.services[_ngcontent-%COMP%]{min-width:250px}.employee[_ngcontent-%COMP%]{min-width:100px}"]})}return i})();function re(i,d){if(i&1&&(a(0,"span",6)(1,"span",7),l(2),o(),a(3,"span",8),l(4),o()()),i&2){let e=d.$implicit,n=d.$index,t=p();w("mt-responsive",n!==0&&t.screenSize>500),s(2),P("",e.name,":"),s(2),c(e.sum)}}var Z=(()=>{class i{employeeCalcs;saveClick=new S;resetClick=new S;screenSize=screen.width;onSaveClick(){this.saveClick.emit()}onResetClick(){this.resetClick.emit()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=y({type:i,selectors:[["app-employee-total"]],inputs:{employeeCalcs:"employeeCalcs"},outputs:{saveClick:"saveClick",resetClick:"resetClick"},standalone:!0,features:[E],decls:12,vars:6,consts:[[1,"is-flex-touch","is-justify-content-center","is-align-items-center"],[1,"tags","has-addons","is-centered","m-0","pb-1","fixed-width-tag",3,"mt-responsive"],[1,"container","is-flex-touch","is-justify-content-center","is-align-items-center"],[1,"mb-1","mx-1"],[1,"button","tag","is-hoverable","is-danger",2,"width","100%",3,"click"],[1,"button","tag","is-hoverable","is-primary",2,"width","100%",3,"click"],[1,"tags","has-addons","is-centered","m-0","pb-1","fixed-width-tag"],[1,"tag","is-info",2,"width","50%"],[1,"tag","is-light","has-text-weight-semibold",2,"width","50%"]],template:function(n,t){n&1&&(a(0,"div",0),R(1,re,5,4,"span",1,I),o(),a(3,"div",2)(4,"div",3)(5,"button",4),_("click",function(){return t.onResetClick()}),l(6),m(7,"translate"),o()(),a(8,"div",3)(9,"button",5),_("click",function(){return t.onSaveClick()}),l(10),m(11,"translate"),o()()()),n&2&&(s(),F(t.employeeCalcs),s(5),c(u(7,2,"Reset")),s(4),c(u(11,4,"Save")))},dependencies:[D,k],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:100px;white-space:nowrap}.pagination-height[_ngcontent-%COMP%]{height:42px}@media (min-width: 1024px){.mt-responsive[_ngcontent-%COMP%]{margin-top:1rem}}@media (max-width: 1023px){.mt-responsive[_ngcontent-%COMP%]{margin-top:0}}"]})}return i})();function le(i,d){i&1&&(a(0,"p"),l(1),m(2,"translate"),o()),i&2&&(s(),P("",u(2,1,"Loading")," ..."))}function pe(i,d){if(i&1&&M(0,"app-error",1),i&2){let e=p();v("error",e.errors())}}function ce(i,d){if(i&1){let e=x();a(0,"div",7)(1,"app-employee-total",8),_("saveClick",function(){h(e);let t=p(2);return C(t.saveTransactions())})("resetClick",function(){h(e);let t=p(2);return C(t.onResetClick())}),o()()}if(i&2){let e=p(2);s(),v("employeeCalcs",e.emloyeeCalcs)}}function me(i,d){if(i&1){let e=x();a(0,"div",5)(1,"app-transactions-table",6),_("transactionUpd",function(t){h(e);let r=p();return C(r.onEmployeeSet(t))})("pageSelected",function(t){h(e);let r=p();return C(r.onPageSelected(t))}),o()(),g(2,ce,2,1,"div",7)}if(i&2){let e=p();s(),v("httpResponse",e.response)("employeeList",e.employees),s(),T(e.authService.getAccessLevel()>1?2:-1)}}function de(i,d){i&1&&(a(0,"div",0)(1,"p"),l(2,"No data for this period"),o()())}var $e=(()=>{class i{httpService;authService;fromDateTime;toDateTime;employees;emloyeeCalcs;savedCalcs;response;dates;errors=q(void 0);requestFlag=!1;constructor(e,n){this.httpService=e,this.authService=n;let t=new Date,r=new Date;t.setUTCHours(0),t.setMinutes(0),t.setSeconds(0),r.setUTCHours(23),r.setMinutes(59),r.setSeconds(0),this.toDateTime=r.toISOString().substring(0,19),this.fromDateTime=t.toISOString().substring(0,19)}calculateEmployeeTransactions(){if(!this.employees)return;let e=[];for(let n of this.employees){let t=this.response?.transactionsOnThePage.filter(r=>r.employee===n&&!r.readonly).map(r=>r.money_accepted).reduce((r,f)=>r+f,0);t=t||0,this.savedCalcs?.has(n)&&(t+=this.savedCalcs?.get(n)),e.push({name:n,sum:t})}this.emloyeeCalcs=e}onEmployeeSet(e){if(e==="update"){this.calculateEmployeeTransactions();return}this.requestFlag=!0,e.subscribe({error:n=>this.errors.set(n),complete:()=>this.requestFlag=!1})}onResetClick(){this.response?.transactionsOnThePage.forEach(e=>{e.readonly||(e.employee="")}),this.calculateEmployeeTransactions()}onDatesSelected(e){this.dates=e,this.loadData(1)}onPageSelected(e){this.loadData(e)}loadData(e){this.requestFlag=!0,this.httpService.getTransactions(this.dates,e-1).subscribe({next:n=>{this.response=U(j({},n),{transactionsOnThePage:n.transactionsOnThePage.map(t=>(t.employee&&(t.readonly=!0),t))}),this.savedCalcs=new Map(Object.entries(n.employeesSum)),this.employees=Array.from(this.savedCalcs.keys())},error:n=>this.errors.set(n),complete:()=>{this.requestFlag=!1,this.onResetClick()}})}saveTransactions(){this.requestFlag=!0,this.response&&this.httpService.updateTransactionsEmployees(this.response.transactionsOnThePage).subscribe({error:e=>{this.errors.set(e)},complete:()=>{this.loadData(this.response.currentPage+1)}})}static \u0275fac=function(n){return new(n||i)(b(O),b(V))};static \u0275cmp=y({type:i,selectors:[["app-transactions"]],standalone:!0,features:[E],decls:9,vars:4,consts:[[1,"is-flex","is-justify-content-center","mt-1"],[3,"error"],[1,"container","is-max-tablet"],[3,"dates"],[1,"columns","is-desktop","is-centered"],[1,"column","is-narrow","is-offset-1-desktop"],[3,"transactionUpd","pageSelected","httpResponse","employeeList"],[1,"column","is-narrow"],[3,"saveClick","resetClick","employeeCalcs"]],template:function(n,t){n&1&&(a(0,"div",0),g(1,le,3,3,"p")(2,pe,1,1,"app-error",1),o(),a(3,"div",2)(4,"app-date-between",3),_("dates",function(f){return t.onDatesSelected(f)}),o()(),a(5,"div",2)(6,"div",4),g(7,me,3,3)(8,de,3,0,"div",0),o()()),n&2&&(w("is-invisible",!t.requestFlag),s(),T(t.errors()?2:1),s(6),T(t.response!=null&&t.response.count&&(t.response!=null&&t.response.count)?7:8))},dependencies:[Y,Z,Q,N,D,k]})}return i})();export{$e as TransactionsComponent};
