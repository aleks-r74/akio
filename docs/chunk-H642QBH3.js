import{a as Y,b as Z,c as E,d as S}from"./chunk-QXLTTRN5.js";import{b as M,c as N,d as $,e as j,f as C,g as l,h as O,i as L,j as P,k as H,m as X,r as J,s as K,t as Q,u as U,v as W}from"./chunk-W74X3RZZ.js";import{$a as f,Ha as _,Ja as p,Ma as g,Na as V,Pa as G,Qa as T,Ra as r,Sa as s,Ta as a,W as b,Wa as R,Xa as v,Ya as x,ea as w,fa as F,fb as h,fc as q,gb as y,gc as D,hb as k,hc as B,jc as z,lb as I,qb as c,rb as d,ua as i,va as A}from"./chunk-HUWQSKRG.js";function ie(o,m){if(o&1&&a(0,"app-error",11),o&2){let e=x(2);p("error",e.errorResponse)}}function re(o,m){o&1&&(r(0,"p"),h(1),c(2,"translate"),s()),o&2&&(i(),k("",d(2,1,"Loading"),"..."))}function se(o,m){if(o&1&&_(0,ie,1,1,"app-error",11)(1,re,3,3,"p"),o&2){let e=x();g(e.errorResponse?0:1)}}function pe(o,m){if(o&1){let e=R();r(0,"div",10)(1,"p",3),a(2,"app-select",12),s(),r(3,"p",3),a(4,"app-select",13),s(),r(5,"p",3),a(6,"input",14),c(7,"translate"),s(),r(8,"p",3),a(9,"input",15),c(10,"translate"),s(),r(11,"p",3),a(12,"input",16),c(13,"translate"),s(),r(14,"p",3),a(15,"input",17),c(16,"translate"),s(),r(17,"p",3)(18,"button",18),v("click",function(){let n=w(e).$index,u=x();return F(u.onDelete(n))}),h(19," X "),s()()()}if(o&2){let e=m.$implicit,t=m.$index,n=x();p("id",t),i(2),p("options",n.options)("control",n.getControl(e,"source")),i(2),p("options",n.options)("control",n.getControl(e,"dest")),i(2),f("placeholder",d(7,13,"Amount")),p("formControl",n.getControl(e,"amount")),i(3),f("placeholder",d(10,15,"Due day")),p("formControl",n.getControl(e,"due_day")),i(3),f("placeholder",d(13,17,"Percentage")),p("formControl",n.getControl(e,"percent")),i(3),f("placeholder",d(16,19,"Description")),p("formControl",n.getControl(e,"descr"))}}var Ce=(()=>{class o{httpService;errorResponse;requestFlag=!1;options=[];expenses=[];constructor(e){this.httpService=e}ngOnInit(){this.requestFlag=!0,this.httpService.getContainers().subscribe({next:e=>{this.options=e.containers.map(t=>t.containerName)},error:e=>this.errorResponse=e,complete:()=>{this.errorResponse=void 0,this.loadExpenses()}})}formGroup=new C({expenses:new U([])});get expensesArray(){return this.formGroup.controls.expenses}getControl(e,t){return e.controls[t]instanceof l?e.controls[t]:e.controls.direction.controls[t]}loadExpenses(){this.requestFlag=!0,this.httpService.getExpenses().subscribe({next:e=>this.expenses=e,error:e=>this.errorResponse=e,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.updateExpensesInView()}})}updateExpensesInView(){this.formGroup.controls.expenses.clear();for(let e of this.expenses)this.createExpense(e.source,e.dest,e.amount,e.due_day,e.percent,e.description,e.id)}createExpense(e,t,n,u,ee,te,ne){let oe=new C({id:new l(ne),direction:new C({source:new l(S(e)),dest:new l(S(t))},Y),amount:new l(n),due_day:new l(u),percent:new l(ee),descr:new l(te,N.required)});this.formGroup.controls.expenses.push(oe)}onAdd(){this.createExpense("From","To",null,null,null,"")}onSave(){let e=[];for(let t of this.formGroup.controls.expenses.controls)e.push({id:t.controls.id?.value,source:E(this.options,t.controls.direction.controls.source.value),dest:E(this.options,t.controls.direction.controls.dest.value),due_day:t.controls.due_day?.value?t.controls.due_day.value:null,amount:t.controls.amount?.value?t.controls.amount.value:null,percent:t.controls.percent?.value?t.controls.percent.value:null,description:t.controls.descr?.value});this.requestFlag=!0,this.httpService.updateExpenses(e).subscribe({next:t=>{this.expenses=t},error:t=>this.errorResponse=t,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.updateExpensesInView()}})}onDelete(e){let t=this.expensesArray.controls[e],n=this.getControl(t,"id").value;n?(this.requestFlag=!0,this.httpService.deleteExpense(n).subscribe({error:u=>this.errorResponse=u,complete:()=>{this.errorResponse=void 0,this.loadExpenses()}})):this.expensesArray.removeAt(e)}static \u0275fac=function(t){return new(t||o)(A(z))};static \u0275cmp=b({type:o,selectors:[["app-expenses"]],standalone:!0,features:[I],decls:18,vars:9,consts:[[1,"container"],[1,"is-flex","is-justify-content-center","m-3"],[1,"field","has-addons"],[1,"control"],[1,"button","is-danger","is-outlined","is-rounded",2,"width","100px",3,"click"],[1,"button","is-danger","is-outlined","is-rounded",2,"width","100px",3,"click","disabled"],[1,"is-flex","is-justify-content-center","m-0","min-height","is-size-7"],[1,"is-size-7","m-2","is-flex","is-justify-content-center"],[3,"formGroup"],["formArrayName","expenses"],[1,"field","has-addons",3,"id"],[3,"error"],["firstOption","From",3,"options","control"],["firstOption","To",3,"options","control"],["type","number","min","0.5",1,"input","is-size-7-touch",2,"max-width","100px",3,"placeholder","formControl"],["type","number","min","1","max","31",1,"input","is-size-7-touch",3,"placeholder","formControl"],["type","number","step","0.001","min","0","max","100",1,"input","is-size-7-touch",3,"placeholder","formControl"],["type","text","maxlength","100",1,"input","is-size-7-touch",3,"placeholder","formControl"],[1,"button","has-background-danger-60","is-size-7-touch",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3)(4,"button",4),v("click",function(){return n.onAdd()}),h(5),c(6,"translate"),s()(),r(7,"p",3)(8,"button",5),v("click",function(){return n.onSave()}),h(9),c(10,"translate"),s()()()(),r(11,"div",6),_(12,se,2,1),s(),r(13,"div",7)(14,"form",8)(15,"ng-component",9),G(16,pe,20,21,"div",10,V),s()()()()),t&2&&(i(5),y(d(6,5,"Add new")),i(3),p("disabled",!n.formGroup.valid),i(),y(d(10,7,"Save All")),i(3),g(n.requestFlag?12:-1),i(2),p("formGroup",n.formGroup),i(2),T(n.expensesArray.controls))},dependencies:[W,O,M,L,$,j,Q,K,J,P,H,X,Z,B,D,q]})}return o})();export{Ce as ExpensesComponent};
