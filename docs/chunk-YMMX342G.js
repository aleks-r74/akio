import{a as B}from"./chunk-64KBLKUM.js";import{a as Z,b as ee,c as k,d as te,e as ie,f as ne,g as N,h as re,k as se,m as oe,n as ae,u as le,v as pe}from"./chunk-W7C6ZKGO.js";import{$a as F,Ha as L,Ja as f,Ma as O,Na as T,Pa as U,Qa as V,Ra as s,Sa as o,Ta as _,Tb as D,W as g,Wa as A,Xa as d,Ya as z,Za as Q,_a as H,ab as W,cb as J,da as E,db as K,ea as h,eb as X,fa as w,fb as m,fc as y,gb as u,gc as S,hb as P,hc as Y,jc as M,lb as b,ma as x,qb as l,rb as p,ua as r,va as I}from"./chunk-6IVGTEVD.js";function ue(n,v){if(n&1&&(s(0,"span",4),m(1),l(2,"titlecase"),o()),n&2){let e=v.$implicit;r(),u(p(2,1,e))}}function fe(n,v){if(n&1){let e=A();s(0,"tr",2)(1,"td",3),m(2),o(),s(3,"td"),U(4,ue,3,3,"span",4,T),o(),s(6,"td")(7,"span",5),d("click",function(){let i=h(e).$implicit,a=z();return w(a.onChangePsw(i.username))}),_(8,"i",6),o(),s(9,"span",5),d("click",function(){let i=h(e).$implicit,a=z();return w(a.onDelete(i.username))}),_(10,"i",7),o()()()}if(n&2){let e=v.$implicit;r(2),u(e.username),r(2),V(e.authorities)}}var de=(()=>{class n{delete=new x;changePass=new x;users;ngOnChanges(e){if(e.users)for(let t=0;t<this.users.length;t++)for(let i=0;i<this.users[t].authorities.length;i++)this.users[t].authorities[i]=this.users[t].authorities[i].slice(5)}onChangePsw(e){this.changePass.emit(e)}onDelete(e){this.delete.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=g({type:n,selectors:[["app-user-table"]],inputs:{users:"users"},outputs:{delete:"delete",changePass:"changePass"},standalone:!0,features:[E,b],decls:14,vars:9,consts:[[1,"is-size-5","is-size-7-touch","is-flex","is-justify-content-center","mt-0"],[1,"table","has-text-centered"],[1,"is-size-6","is-size-7-touch"],[1,"is-vcentered"],[1,"tag","is-primary","fixed-width-tag","m-1"],[1,"tag","icon","mx-4","is-hoverable",3,"click"],["title","Change password",1,"fa-solid","fa-key"],["title","delete",1,"fa-solid","fa-trash-can"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"table",1)(2,"tr")(3,"td"),m(4),l(5,"translate"),o(),s(6,"td"),m(7),l(8,"translate"),o(),s(9,"td"),m(10),l(11,"translate"),o()(),U(12,fe,11,1,"tr",2,T),o()()),t&2&&(r(4),u(p(5,3,"Username")),r(3),u(p(8,5,"Authorities")),r(3),u(p(11,7,"Actions")),r(2),V(i.users))},dependencies:[D,S,y]})}return n})();var me=(()=>{class n{addNew=new x;onAddNewClick(){this.addNew.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=g({type:n,selectors:[["app-add-new"]],outputs:{addNew:"addNew"},standalone:!0,features:[b],decls:7,vars:3,consts:[[1,"is-size-5","is-flex","is-justify-content-center","m-4"],[1,"tags","has-addons",3,"click"],[1,"tag","is-danger","is-size-6"],[1,"tag","is-hoverable","is-size-6"],[1,"fa-regular","fa-square-plus"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1),d("click",function(){return i.onAddNewClick()}),s(2,"span",2),m(3),l(4,"translate"),o(),s(5,"span",3),_(6,"i",4),o()()()),t&2&&(r(3),u(p(4,1,"Add new")))},dependencies:[S,y]})}return n})();var he=["*"],j=(()=>{class n{title;disabled=!1;confirmed=new x;onConfirm(e){this.confirmed.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=g({type:n,selectors:[["app-confirmation"]],inputs:{title:"title",disabled:"disabled"},outputs:{confirmed:"confirmed"},standalone:!0,features:[b],ngContentSelectors:he,decls:13,vars:8,consts:[[1,"message"],[1,"message-header"],[1,"message-body","is-size-7-touch"],[1,"is-flex","is-justify-content-end","my-2"],[1,"button","m-1","is-info","is-light",3,"click","disabled"],[1,"button","m-1","is-info",3,"click"]],template:function(t,i){t&1&&(Q(),s(0,"article",0)(1,"div",1)(2,"p"),m(3),o()(),s(4,"div",2),H(5),s(6,"div",3)(7,"button",4),d("click",function(){return i.onConfirm(!0)}),m(8),l(9,"translate"),o(),s(10,"button",5),d("click",function(){return i.onConfirm(!1)}),m(11),l(12,"translate"),o()()()()),t&2&&(r(3),u(i.title),r(4),f("disabled",i.disabled),r(),u(p(9,4,"Confirm")),r(3),u(p(12,6,"Cancel")))},dependencies:[S,y]})}return n})();function _e(n,v){if(n&1&&(s(0,"label",6),_(1,"input",7),m(2),l(3,"titlecase"),o()),n&2){let e=v.$implicit,t=v.$index;r(),f("formControlName",t),r(),P(" ",p(3,2,e.name)," ")}}var ce=(()=>{class n{httpService;showWindow=!1;authorities;close=new x;constructor(e){this.httpService=e}newUserForm=new ne({checkboxes:new le([]),username:new N("",[k.required,k.minLength(3)]),password:new N("",[k.required,k.minLength(3)])});get checkboxes(){return this.newUserForm.controls.checkboxes}ngOnChanges(e){e.authorities&&this.authorities.forEach(t=>{let i=new $("");i.name=t.slice(5),this.checkboxes.push(i)})}onConfirmClick(e){if(e){let t=this.newUserForm.controls?.username.value,i=this.newUserForm.controls?.password.value,a=this.checkboxes.controls.filter(c=>c.value).map(c=>"ROLE_"+c.name),C={username:t,password:i,authorities:a};this.close.emit(this.httpService.addNewUser(C)),this.checkboxes.controls.forEach(c=>c.setValue(!1)),Object.entries(this.newUserForm.controls).forEach(([c,G])=>{G instanceof N&&G.setValue("")});return}this.close.emit(void 0)}static \u0275fac=function(t){return new(t||n)(I(M))};static \u0275cmp=g({type:n,selectors:[["app-add-new-form"]],inputs:{showWindow:"showWindow",authorities:"authorities"},outputs:{close:"close"},standalone:!0,features:[E,b],decls:11,vars:12,consts:[[3,"close","active"],[3,"confirmed","title","disabled"],[3,"formGroup"],["type","text","formControlName","username",1,"input","m-1","is-size-7-touch",3,"placeholder"],["type","text","formControlName","password",1,"input","m-1","is-size-7-touch",3,"placeholder"],["formArrayName","checkboxes",1,"checkboxes","is-flex","is-justify-content-space-between"],[1,"checkbox","mx-1"],["type","checkbox",3,"formControlName"]],template:function(t,i){t&1&&(s(0,"app-modal",0),d("close",function(){return i.showWindow=!1}),s(1,"app-confirmation",1),l(2,"translate"),d("confirmed",function(C){return i.onConfirmClick(C)}),s(3,"form",2),_(4,"input",3),l(5,"translate"),_(6,"input",4),l(7,"translate"),s(8,"div",5),U(9,_e,4,4,"label",6,T),o()()()()),t&2&&(f("active",i.showWindow),r(),F("title",p(2,6,"Create new user")),f("disabled",i.newUserForm.invalid),r(2),f("formGroup",i.newUserForm),r(),F("placeholder",p(5,8,"Username")),r(2),F("placeholder",p(7,10,"Password")),r(3),V(i.checkboxes.controls))},dependencies:[B,j,pe,re,ee,Z,te,ie,se,ae,oe,D,S,y]})}return n})(),$=class extends N{name="";constructor(v,e,t){super(v,e,t)}};var Ce=["pswInput"];function ve(n,v){n&1&&(s(0,"p"),m(1),l(2,"translate"),o()),n&2&&(r(),P("",p(2,1,"Loading")," ..."))}function ge(n,v){n&1&&(s(0,"p"),m(1),l(2,"translate"),o()),n&2&&(r(),u(p(2,1,"Password updated")))}var nt=(()=>{class n{httpService;modalAddNewVisible=!1;modalChangePswVisible=!1;modalDeleteVisible=!1;selectedUser;requestFlag=!1;errorResponse;passUpdated=!1;pswInput;authorities=[];users=[];constructor(e){this.httpService=e}ngOnInit(){this.httpService.getAllAuthorities().subscribe({next:e=>this.authorities=e,error:e=>this.errorResponse=e,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.loadUsers()}})}onAddNew(){this.modalAddNewVisible=!0}onAddNewClose(e){this.modalAddNewVisible=!1,e&&(this.requestFlag=!0,e.subscribe({next:t=>{this.users=[],this.users=t},error:t=>this.errorResponse=t,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}}))}onPassIconClick(e){this.selectedUser=e,this.modalChangePswVisible=!0}onDeleteIconClick(e){this.selectedUser=e,this.modalDeleteVisible=!0}onDeleteConfirm(e){e&&(this.requestFlag=!0,this.httpService.deleteUser(this.selectedUser).subscribe({next:t=>{this.users=[],this.users=t},error:t=>this.errorResponse=t,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})),this.modalDeleteVisible=!1}onPassChangeConfirm(e){let t=this.pswInput.nativeElement;e&&(this.requestFlag=!0,this.httpService.updateUserPassword({username:this.selectedUser,password:t.value,authorities:[]}).subscribe({next:()=>{},error:i=>this.errorResponse=i,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.passUpdated=!0,setTimeout(()=>this.passUpdated=!1,3e3)}}),t.value=""),t.value="",this.modalChangePswVisible=!1}loadUsers(){this.requestFlag=!0,this.httpService.getAllUsersWithAuthorities().subscribe({next:e=>{this.users=[],this.users=e},error:e=>this.errorResponse=e,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}static \u0275fac=function(t){return new(t||n)(I(M))};static \u0275cmp=g({type:n,selectors:[["app-users"]],viewQuery:function(t,i){if(t&1&&J(Ce,5),t&2){let a;K(a=X())&&(i.pswInput=a.first)}},standalone:!0,features:[b],decls:19,vars:24,consts:[["pswInput",""],[3,"addNew"],[1,"is-flex","is-justify-content-center","mt-1","min-height"],[3,"error"],[3,"close","authorities","showWindow"],[3,"changePass","delete","users"],[3,"close","active"],[3,"confirmed","title"],["type","text",1,"input","m-1",3,"placeholder"]],template:function(t,i){if(t&1){let a=A();s(0,"app-add-new",1),d("addNew",function(){return h(a),w(i.onAddNew())}),o(),s(1,"div",2),L(2,ve,3,3,"p")(3,ge,3,3,"p"),_(4,"app-error",3),o(),s(5,"app-add-new-form",4),d("close",function(c){return h(a),w(i.onAddNewClose(c))}),o(),s(6,"app-user-table",5),d("changePass",function(c){return h(a),w(i.onPassIconClick(c))})("delete",function(c){return h(a),w(i.onDeleteIconClick(c))}),o(),s(7,"app-modal",6),d("close",function(){return h(a),w(i.modalChangePswVisible=!1)}),s(8,"app-confirmation",7),l(9,"translate"),d("confirmed",function(c){return h(a),w(i.onPassChangeConfirm(c))}),_(10,"input",8,0),l(12,"translate"),o()(),s(13,"app-modal",6),d("close",function(){return h(a),w(i.modalDeleteVisible=!1)}),s(14,"app-confirmation",7),l(15,"translate"),d("confirmed",function(c){return h(a),w(i.onDeleteConfirm(c))}),s(16,"div"),m(17),l(18,"translate"),o()()()}t&2&&(r(2),O(!i.errorResponse&&i.requestFlag?2:-1),r(),O(i.passUpdated?3:-1),r(),f("error",i.errorResponse),r(),f("authorities",i.authorities)("showWindow",i.modalAddNewVisible),r(),f("users",i.users),r(),f("active",i.modalChangePswVisible),r(),W("title","",p(9,16,"Changing password for")," ",i.selectedUser,""),r(2),F("placeholder",p(12,18,"New password")),r(3),f("active",i.modalDeleteVisible),r(),W("title","",p(15,20,"Do you want to delete")," ",i.selectedUser,"?"),r(3),u(p(18,22,"After you click confirm user will be deleted")))},dependencies:[de,me,B,j,ce,Y,S,y]})}return n})();export{nt as UsersComponent};
