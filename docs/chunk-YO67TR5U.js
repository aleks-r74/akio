import{c as ne,d as ie,e as oe}from"./chunk-GVC2SZYH.js";import{a as _e,b as Ce,c as A}from"./chunk-XVUEVHX3.js";import{h as te}from"./chunk-VBFU6JAC.js";import{a as X}from"./chunk-64KBLKUM.js";import{b as ae,c as P,d as re,e as se,f as G,g as V,h as le,i as me,k as ce,l as pe,n as de,s as ue,t as fe,v as he}from"./chunk-W7C6ZKGO.js";import{$a as $,Ha as v,Ja as f,Ka as B,Ma as C,Na as b,Pa as E,Qa as D,Ra as a,Rb as O,Sa as r,Ta as F,Tb as N,Ua as Y,Ub as W,Va as H,W as S,Wa as w,Xa as d,Ya as u,a as q,b as R,da as z,ea as g,fa as y,fb as s,fc as I,gb as h,gc as k,hb as T,hc as Z,ib as J,jc as ee,lb as x,ma as M,ob as K,pb as Q,qb as l,rb as m,sb as U,ua as o,va as L}from"./chunk-6IVGTEVD.js";function Fe(t,p){if(t&1){let e=w();a(0,"div",0)(1,"div",1)(2,"form",2),d("ngSubmit",function(){g(e);let i=u();return y(i.onSubmit())}),a(3,"div",3),Y(4,4),a(5,"p",5),F(6,"app-select",6),r(),a(7,"p",5),F(8,"app-select",7),r(),H(),a(9,"p",5),F(10,"input",8),l(11,"translate"),r(),a(12,"p",5),F(13,"input",9),l(14,"translate"),r(),a(15,"p",5)(16,"button",10),s(17),l(18,"translate"),r()()()()()()}if(t&2){let e=u();o(2),f("formGroup",e.transferForm),o(4),f("control",e.sourceControl)("options",e.sources),o(2),f("control",e.destControl)("options",e.dests),o(2),$("placeholder",m(11,9,"Amount")),o(3),$("placeholder",m(14,11,"Description")),o(3),f("disabled",!e.transferForm.valid),o(),T(" ",m(18,13,"Transfer")," ")}}var ye=(()=>{class t{sources=[];dests=[];moneyFlowEvent=new M;transferForm=new G({direction:new G({source:new V("From",P.required),dest:new V("To",P.required)},_e),amount:new V("",[P.required,P.min(1)]),descr:new V("",P.required)});get sourceControl(){return this.transferForm.controls.direction.controls.source}get destControl(){return this.transferForm.controls.direction.controls.dest}onSubmit(){let e=this.transferForm.controls.direction.get("source").value,n=this.transferForm.controls.direction.get("dest").value;e=A(this.sources,e),n=A(this.dests,n);let i={source:e,dest:n,amount:parseFloat(this.transferForm.controls.amount.value),description:this.transferForm.controls.descr.value};this.transferForm.controls.amount.setValue(""),this.transferForm.controls.descr.setValue(""),this.moneyFlowEvent.emit(i)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=S({type:t,selectors:[["app-transfer-form"]],inputs:{sources:"sources",dests:"dests"},outputs:{moneyFlowEvent:"moneyFlowEvent"},standalone:!0,features:[x],decls:1,vars:1,consts:[[1,"container","is-max-tablet"],[1,"m-1","is-flex","is-justify-content-center"],[3,"ngSubmit","formGroup"],[1,"field","has-addons"],["formGroupName","direction"],[1,"control"],["firstOption","From",3,"control","options"],["firstOption","To",3,"control","options"],["type","number","min","0.5","formControlName","amount",1,"input","is-size-7-touch",3,"placeholder"],["type","text","formControlName","descr","maxlength","100",1,"input","is-size-7-touch",3,"placeholder"],["type","submit",1,"button","is-info","is-size-7-touch",3,"disabled"]],template:function(n,i){n&1&&v(0,Fe,19,15,"div",0),n&2&&C(i.sources.length&&i.dests.length?0:-1)},dependencies:[he,le,ae,me,re,se,fe,ue,ce,de,pe,Ce,k,I]})}return t})();var xe=(t,p)=>({"has-background-success-95":t,"has-background-success-75":p});function Me(t,p){if(t&1){let e=w();a(0,"button")(1,"span",2),F(2,"i",3)(3,"i",4),r(),a(4,"table",5),d("click",function(){let i=g(e).$implicit,c=u(2);return y(c.onContainerClick(i))}),a(5,"tr")(6,"td",6),s(7),r()(),a(8,"tr")(9,"td"),s(10),r()()()()}if(t&2){let e=p.$implicit,n=u(2);o(2),B("is-invisible",!n.checkInFlow(e.containerName)),o(),B("is-invisible",!n.checkOutFlow(e.containerName)),o(),f("ngClass",K(7,xe,e!=n.selected,e==n.selected)),o(3),h(e.containerName),o(3),h(e.balance)}}function Te(t,p){if(t&1&&(a(0,"div",0)(1,"div",1),E(2,Me,11,10,"button",null,b),r()()),t&2){let e=u();o(2),D(e.containers)}}var ve=(()=>{class t{containers;summaryMfs;clickEvent=new M;templateBgColor="has-background-success-95";selectedBgColor="has-background-success-75";selected;outFlow=[];inFlow=[];ngOnChanges(e){if(!this.summaryMfs)return;let n=new Date;this.inFlow=[],this.outFlow=[];for(let i of this.summaryMfs){let c=new Date(i.time_stamp),_=c.getDate()===n.getDate()&&c.getMonth()===n.getMonth()&&c.getFullYear()===n.getFullYear();_&&this.inFlow?.push(i.dest),_&&this.outFlow?.push(i.source)}}checkInFlow(e){for(let n of this.inFlow)if(n===e)return!0;return!1}checkOutFlow(e){for(let n of this.outFlow)if(n===e)return!0;return!1}onContainerClick(e){this.selected=e,this.clickEvent.emit(e)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=S({type:t,selectors:[["app-containers"]],inputs:{containers:"containers",summaryMfs:"summaryMfs"},outputs:{clickEvent:"containerClick"},standalone:!0,features:[z,x],decls:1,vars:1,consts:[[1,"is-flex","is-justify-content-center"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"icon"],[1,"fa-solid","fa-angles-down","mx-1"],[1,"fa-solid","fa-angles-up","mx-1"],[1,"has-background-success-95","fixed-width-tag","has-text-centered","is-size-6",3,"click","ngClass"],[1,"is-capitalized","has-text-weight-bold"]],template:function(n,i){n&1&&v(0,Te,4,0,"div",0),n&2&&C(i.containers?0:-1)},dependencies:[O],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:90px;white-space:nowrap;border-radius:10px}"]})}return t})();var be=(t,p,e)=>({"has-background-info-65":t,"has-background-info-35":p,highlighted:e});function Ee(t,p){if(t&1){let e=w();a(0,"button",4),d("click",function(){let i=g(e).$implicit,c=u();return y(c.onDirectionSelected(i))}),s(1),l(2,"titlecase"),l(3,"titlecase"),r()}if(t&2){let e=p.$implicit,n=u();f("ngClass",Q(7,be,e!=n.selected,e==n.selected,n.isFreshDirection(e))),o(),J("",m(2,3,e.source)," -> ",m(3,5,e.dest),"")}}var we=(()=>{class t{directions;summaryMfs;directionSelected=new M;selected;fresh=[];ngOnChanges(e){if(e.directions&&this.directions?.length==1&&setTimeout(()=>this.onDirectionSelected(this.directions[0]),0),!e.summaryMfs||!this.summaryMfs)return;let n=new Date;for(let i of this.summaryMfs){let c=new Date(i.time_stamp);c.getDate()===n.getDate()&&c.getMonth()===n.getMonth()&&c.getFullYear()===n.getFullYear()&&this.fresh.push({source:i.source,dest:i.dest})}}onDirectionSelected(e){this.selected=e,this.directionSelected.emit(e)}isFreshDirection(e){return this.fresh.some(n=>n.source===e.source&&n.dest===e.dest)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=S({type:t,selectors:[["app-money-direction"]],inputs:{directions:"directions",summaryMfs:"summaryMfs"},outputs:{directionSelected:"directionSelected"},standalone:!0,features:[z,x],decls:5,vars:0,consts:[[1,"container","is-max-tablet","has-text-centered","mt-2"],[1,"fixed-grid","has-4-cols"],[1,"cell"],[1,"button","tag","is-hoverable","has-text-white","m-1","is-size-6","is-size-7-mobile",3,"ngClass"],[1,"button","tag","is-hoverable","has-text-white","m-1","is-size-6","is-size-7-mobile",3,"click","ngClass"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),E(3,Ee,4,11,"button",3,b),r()()()),n&2&&(o(3),D(i.directions))},dependencies:[O,N],styles:["div[_ngcontent-%COMP%]{min-height:35px}span[_ngcontent-%COMP%]{min-width:90px}.highlighted[_ngcontent-%COMP%]{border-color:#96dfbe;border-bottom-width:5px}"]})}return t})();function De(t,p){t&1&&(a(0,"th",2),s(1),l(2,"translate"),r()),t&2&&(o(),h(m(2,1,"Cancel")))}function Ie(t,p){if(t&1){let e=w();a(0,"td")(1,"a",3),d("click",function(){g(e);let i=u().$implicit,c=u(2);return y(c.onCancel(i.receipt_num))}),s(2),l(3,"translate"),r()()}if(t&2){let e=u().$index;o(),B("is-hidden",e!=0),o(),T(" ",m(3,3,"Cancel"),"")}}function ke(t,p){if(t&1&&(a(0,"tr")(1,"td"),s(2),l(3,"date"),r(),a(4,"td"),s(5),r(),a(6,"td"),s(7),l(8,"titlecase"),r(),a(9,"td"),s(10),l(11,"titlecase"),r(),a(12,"td"),s(13),r(),v(14,Ie,4,5,"td"),r()),t&2){let e=p.$implicit,n=u(2);o(2),h(U(3,6,e.time_stamp,"MMMM d, HH:mm")),o(3),T(" ",e.initiator,""),o(2),h(m(8,9,e.source)),o(3),h(m(11,11,e.dest)),o(3),h(e.amount),o(),C(n.showCancel?14:-1)}}function Pe(t,p){if(t&1&&(a(0,"table",0)(1,"thead")(2,"tr")(3,"th",2),s(4),l(5,"translate"),r(),a(6,"th",2),s(7),l(8,"translate"),r(),a(9,"th",2),s(10),l(11,"translate"),r(),a(12,"th",2),s(13),l(14,"translate"),r(),a(15,"th",2),s(16),l(17,"translate"),r(),v(18,De,3,3,"th",2),r()(),a(19,"tbody"),E(20,ke,15,13,"tr",null,b),r()()),t&2){let e=u();o(4),h(m(5,6,"Last transaction")),o(3),h(m(8,8,"Initiator")),o(3),h(m(11,10,"Source")),o(3),h(m(14,12,"Dest")),o(3),h(m(17,14,"Total")),o(2),C(e.showCancel?18:-1),o(2),D(e.summary)}}function Be(t,p){t&1&&(a(0,"p",1),s(1),l(2,"translate"),r()),t&2&&(o(),T(" ",m(2,1,"There are no user's transactions today"),""))}var Se=(()=>{class t{summary;showCancel=!1;cancelMF=new M;onCancel(e){this.cancelMF.emit(e)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=S({type:t,selectors:[["app-flow-summary"]],inputs:{summary:"summary",showCancel:"showCancel"},outputs:{cancelMF:"cancelMF"},standalone:!0,features:[x],decls:2,vars:1,consts:[[1,"table","is-size-7","has-text-centered","is-hoverable","is-striped"],[1,"box"],[1,"has-text-centered"],[1,"tag","is-danger",3,"click"]],template:function(n,i){n&1&&v(0,Pe,22,16,"table",0)(1,Be,3,3,"p",1),n&2&&C((i.summary==null?null:i.summary.length)>0?0:1)},dependencies:[k,I,N,W]})}return t})();function Ve(t,p){if(t&1&&F(0,"app-error",2),t&2){let e=u();f("error",e.errorResponse)}}function qe(t,p){t&1&&(a(0,"p",3),s(1),l(2,"translate"),r()),t&2&&(o(),h(m(2,1,"Money transferred")))}function Re(t,p){t&1&&(a(0,"p",3),s(1),l(2,"translate"),r()),t&2&&(o(),h(m(2,1,"Transaction cancelled")))}function ze(t,p){t&1&&(a(0,"p",3),s(1),l(2,"translate"),r()),t&2&&(o(),T("",m(2,1,"Loading"),"..."))}function Oe(t,p){if(t&1){let e=w();a(0,"div",6)(1,"p",19)(2,"button",20),d("click",function(){g(e);let i=u();return y(i.showSummarizedTransactions=!0)}),s(3),l(4,"translate"),r()(),a(5,"p",19)(6,"button",20),d("click",function(){g(e);let i=u();return y(i.showLastTransactions=!0)}),s(7),l(8,"translate"),r()()()}t&2&&(o(3),h(m(4,2,"Month overview")),o(4),h(m(8,4,"My Transactions")))}function Ne(t,p){if(t&1){let e=w();a(0,"button",20),d("click",function(){g(e);let i=u();return y(i.showLastTransactions=!0)}),s(1),l(2,"translate"),r()}t&2&&(o(),h(m(2,1,"My Transactions")))}var Bt=(()=>{class t{httpService;authService;containers;sources=[];dests=[];summaryMfs;freshMfs;selectedConatiner;moneyFlowResponseDto;dates;totalPages;currentPage=1;transactionDetails;showDetails=!1;showLastTransactions=!1;showSummarizedTransactions=!1;moneyFlowRequest={from:void 0,to:void 0,source:void 0,dest:void 0,page:this.currentPage-1};errorResponse;requestFlag=!1;moneyTransferredFlag=!1;transactionCancelledFlag=!1;constructor(e,n){this.httpService=e,this.authService=n}ngOnInit(){this.requestFlag=!0,this.httpService.getContainers().subscribe({next:e=>{this.containers=e.containers,this.sources=e.allowedSources,this.dests=e.allowedDests,this.summaryMfs=e.summarizedTransactions.reverse(),this.freshMfs=e.lastTransactions.reverse()},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}onMoneyTransfer(e){this.resetFlags(),this.requestFlag=!0,this.httpService.transferMoney(e).subscribe({next:n=>{this.containers=n},error:n=>{this.errorResponse=n},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.moneyTransferredFlag=!0,this.ngOnInit()}})}onDatesSelected(e){this.moneyFlowRequest=R(q({},this.moneyFlowRequest),{from:e.from,to:e.to,page:this.currentPage-1}),this.loadMoneyFlows()}onContainerClick(e){this.selectedConatiner=e}onPageSelected(e){this.moneyFlowRequest=R(q({},this.moneyFlowRequest),{page:e-1}),this.currentPage=e,this.loadMoneyFlows()}onDirectionSelected(e){this.currentPage=1,this.moneyFlowRequest=R(q({},this.moneyFlowRequest),{source:e.source,dest:e.dest,page:this.currentPage-1}),this.loadMoneyFlows()}loadMoneyFlows(){Object.values(this.moneyFlowRequest).some(e=>e==null)||(this.resetFlags(),this.requestFlag=!0,this.httpService.getMoneyFlows(this.moneyFlowRequest).subscribe({next:e=>{this.moneyFlowResponseDto=e,this.totalPages=e.totalPages},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}}))}loadTransactionByTimestamp(e){this.resetFlags(),this.requestFlag=!0,this.httpService.getTransactions({from:e,to:e},0).subscribe({next:n=>{this.transactionDetails=n.transactionsOnThePage[0],this.showDetails=!0},error:n=>{this.errorResponse=n},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}onCancelMF(e){this.resetFlags(),this.requestFlag=!0,this.httpService.cancelMoneyFlow(e).subscribe({error:n=>this.errorResponse=n,complete:()=>{this.ngOnInit(),this.transactionCancelledFlag=!0}})}resetFlags(){this.requestFlag=!1,this.moneyTransferredFlag=!1,this.transactionCancelledFlag=!1}static \u0275fac=function(n){return new(n||t)(L(ee),L(te))};static \u0275cmp=S({type:t,selectors:[["app-money-management"]],standalone:!0,features:[x],decls:22,vars:20,consts:[[1,"container","is-max-tablet"],[1,"is-flex","is-justify-content-center","mt-1",2,"min-height","35px"],[3,"error"],[1,"is-size-7"],[3,"moneyFlowEvent","sources","dests"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"field","has-addons"],[1,"button","is-size-7-touch","is-size-6","tag","mt-2"],[3,"containerClick","containers","summaryMfs"],[3,"directionSelected","directions","summaryMfs"],[3,"dates"],[1,"container"],[1,"columns","is-centered"],[1,"column","is-flex","is-justify-content-center","p-0","m-0"],[3,"receiptSelected","pageSelected","data","showDetails"],[3,"close","active","transaction"],[3,"close","active"],[3,"summary"],[3,"cancelMF","summary","showCancel"],[1,"control"],[1,"button","is-size-7-touch","is-size-6","tag","mt-2",3,"click"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1),v(2,Ve,1,1,"app-error",2)(3,qe,3,3,"p",3)(4,Re,3,3,"p",3)(5,ze,3,3,"p",3),r(),a(6,"app-transfer-form",4),d("moneyFlowEvent",function(_){return i.onMoneyTransfer(_)}),r(),a(7,"div",5),v(8,Oe,9,6,"div",6)(9,Ne,3,3,"button",7),r(),a(10,"app-containers",8),d("containerClick",function(_){return i.onContainerClick(_)}),r(),a(11,"app-money-direction",9),d("directionSelected",function(_){return i.onDirectionSelected(_)}),r(),a(12,"app-date-between",10),d("dates",function(_){return i.onDatesSelected(_)}),r(),a(13,"div",11)(14,"div",12)(15,"div",13)(16,"app-money-flow-table",14),d("receiptSelected",function(_){return i.loadTransactionByTimestamp(_)})("pageSelected",function(_){return i.onPageSelected(_)}),r()()()(),a(17,"app-transaction-details",15),d("close",function(){return i.showDetails=!1}),r(),a(18,"app-modal",16),d("close",function(){return i.showSummarizedTransactions=!1}),F(19,"app-flow-summary",17),r(),a(20,"app-modal",16),d("close",function(){return i.showLastTransactions=!1}),a(21,"app-flow-summary",18),d("cancelMF",function(_){return i.onCancelMF(_)}),r()()()),n&2&&(o(2),C(i.errorResponse?2:-1),o(),C(i.moneyTransferredFlag&&!i.requestFlag?3:-1),o(),C(i.transactionCancelledFlag&&!i.requestFlag?4:-1),o(),C(i.requestFlag&&!i.errorResponse?5:-1),o(),f("sources",i.sources)("dests",i.dests),o(2),C(i.authService.getAccessLevel()>1?8:9),o(2),f("containers",i.containers)("summaryMfs",i.summaryMfs),o(),f("directions",i.selectedConatiner==null?null:i.selectedConatiner.directions)("summaryMfs",i.summaryMfs),o(5),f("data",i.moneyFlowResponseDto)("showDetails",!0),o(),f("active",i.showDetails)("transaction",i.transactionDetails),o(),f("active",i.showSummarizedTransactions),o(),f("summary",i.summaryMfs),o(),f("active",i.showLastTransactions),o(),f("summary",i.freshMfs)("showCancel",!0))},dependencies:[ye,ve,oe,ne,Z,we,ie,k,I,Se,X]})}return t})();export{Bt as MoneyManagementComponent};
